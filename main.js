h=''
for(let t=0;t<4;t+=1){
  h+=`<div class='d3' id='d3${t}'>`
  for(let z=0;z<4;z+=1){
    h+=`<div class='d2' id='d2${t}${z}'>`
    for(let y=0;y<4;y+=1){
      h+=`<div class='d1' id='d2${t}${z}${y}'>`
      for(let x=0;x<4;x+=1){
        h+=`<div class='d0' id='d0${t}${z}${y}${x}'>`
        h+=`</div>`
      }
      h+=`</div>`
    }
    h+=`</div>`
  }
  h+=`</div>`
}

document.getElementById("d4").innerHTML=h;

let curt=0;
let state=[[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]]];

d0l=document.querySelectorAll(".d0");
for(let i=0;i<d0l.length;i+=1){
  d0l[i].addEventListener("click",(event)=>{
    w=(Number)(event.target.id[2]);
    z=(Number)(event.target.id[3]);
    y=(Number)(event.target.id[4]);
    x=(Number)(event.target.id[5]);
    if(state[w][z][y][x]!=-1){
      return;
    }
    event.target.style.backgroundColor=["#ff0080","#0080ff"][curt];
    state[w][z][y][x]=curt;
    for(let dw=0;dw<=1;dw+=1){
      for(let dz=-1;dz<=1;dz+=1){
        for(let dy=-1;dy<=1;dy+=1){
          for(let dx=-1;dx<=1;dx+=1){
            if(dw==0){
              if(dz==-1)continue;
              if(dz==0){
                if(dy==-1)continue;
                if(dy==0){
                  if(dx!=1)continue;
                }
              }
            }
            let c=0;
            for(k=-3;k<=3;k+=1){
              x2=x+k*dx
              y2=y+k*dy
              z2=z+k*dz
              w2=w+k*dw
              if(x2<0||x2>3||y2<0||y2>3||z2<0||z2>3||w2<0||w2>3)continue;
              if(state[w2][z2][y2][x2]==curt)c+=1;
            }
            if(c==4){
              for(k=-3;k<=3;k+=1){
                x2=x+k*dx
                y2=y+k*dy
                z2=z+k*dz
                w2=w+k*dw
                if(x2<0||x2>3||y2<0||y2>3||z2<0||z2>3||w2<0||w2>3)continue;
                document.getElementById(`d0${w2}${z2}${y2}${x2}`).style.backgroundColor=["#ff80c0","#80c0ff"][curt];
              }
            }
          }
        }
      }
    }
    curt=1-curt;
  });
}
